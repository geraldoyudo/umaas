!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.TraversonJsonHalAdapter=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(a){this.log=a}function d(a){var b=a.match(/(.*)\[(.*):(.*)\]/);return b?{key:b[1],secondaryKey:b[2],secondaryValue:b[3],index:null,all:!1}:(b=a.match(/(.*)\[(\d+)\]/))?{key:b[1],secondaryKey:null,secondaryValue:null,index:b[2],all:!1}:(b=a.match(/(.*)\[\$all\]/),b?{key:b[1],secondaryKey:null,secondaryValue:null,index:null,all:!0}:{key:a,secondaryKey:null,secondaryValue:null,index:null,all:!1})}function e(a,b){a.hasCuries()&&(b.curie=a.reverseResolveCurie(b.key))}function f(a,b,c){var d=a.linkArray(b.key);if(d||(d=a.linkArray(b.curie)),!d||0===d.length)return null;var e=g(d,b,c);return e||(e=h(d,b,c)),e||(e=i(d,b,c)),e}function g(a,b,c){if(b.secondaryKey&&b.secondaryValue){for(var d=0;d<a.length;d++){var e=a[d][b.secondaryKey];if(null!=e&&e==b.secondaryValue){if(!a[d].href)throw new Error(b.key+"["+b.secondaryKey+":"+b.secondaryValue+"] requested, but this link had no href attribute.");return c.debug("found hal link: "+a[d].href),{uri:a[d].href}}}throw new Error(b.key+"["+b.secondaryKey+":"+b.secondaryValue+"] requested, but there is no such link.")}return null}function h(a,b,c){if("undefined"!=typeof b.index&&null!==b.index){if(!a[b.index])throw new Error(b.key+"["+b.index+"] requested, but link array "+b.key+" had no element at index "+b.index);if(!a[b.index].href)throw new Error(b.key+"["+b.index+"] requested, but this link had no href attribute.");return c.debug("found hal link: "+a[b.index].href),{uri:a[b.index].href}}return null}function i(a,b,c){for(var d,e=0;e<a.length;e++)if(a[e].href){d=a[e];break}return d?(a.length>1&&c.warn("Found HAL link array with more than one element for key "+b.key+", arbitrarily choosing index "+e+", because it was the first that had a href attribute."),c.debug("found hal link: "+d.href),{uri:d.href}):null}function j(a,b,c,d){d.debug("checking for embedded: "+c.key+(c.index?c.index:""));var e=a.embeddedArray(c.key);if(!e||0===e.length)return null;d.debug("Found an array of embedded resource for: "+c.key);var f=k(e,c,a,d);return f||(f=l(e,c,d)),f}function k(a,b,c,d){if(b.all)return{doc:c.original()._embedded[b.key]};if(b.index){if(!a[b.index])throw new Error(b.key+"["+b.index+"] requested, but there is no such link. However, there is an embedded resource array named "+b.key+" but it does not have an element at index "+b.index);return d.debug("Found an embedded resource for: "+b.key+"["+b.index+"]"),{doc:a[b.index].original()}}return null}function l(a,b,c){return a.length>1&&c.warn("Found HAL embedded resource array with more than one element  for key "+b.key+", arbitrarily choosing first element."),{doc:a[0].original()}}var m=a("halfred");c.mediaType="application/hal+json",c.prototype.findNextStep=function(a,b){this.log.debug("parsing hal");var c=m.parse(a),g=d(b);e(c,g);var h=f(c,g,this.log);if(h)return h;if(h=j(c,a,g,this.log))return h;throw new Error("Could not find a link nor an embedded object for "+JSON.stringify(g)+" in document:\n"+JSON.stringify(a))},b.exports=c},{halfred:2}],2:[function(a,b){var c=a("./lib/parser"),d=!1;b.exports={parse:function(a){return(new c).parse(a,d)},enableValidation:function(a){d=null!=a?a:!0},disableValidation:function(){d=!1}}},{"./lib/parser":4}],3:[function(a,b){"use strict";function c(){this._array=arguments.length>=1?arguments[0]:[]}c.prototype.array=function(){return this._array},c.prototype.isEmpty=function(){return 0===this._array.length},c.prototype.push=function(a){var b=this._array.slice(0);return b.push(a),new c(b)},c.prototype.pop=function(){var a=this._array.slice(0,this._array.length-1);return new c(a)},c.prototype.peek=function(){if(this.isEmpty())throw new Error("can't peek on empty stack");return this._array[this._array.length-1]},b.exports=c},{}],4:[function(a,b){"use strict";function c(){}function d(a,b,c){if(null==a)return a;var d=e(a._links,b,c.push("_links")),i=f(d),j=g(a._embedded,b,c.push("_embedded")),k=new s(d,i,j,b);return h(a,k),k._original=a,k}function e(a,b,c){return a=i(a,k,b,c),(null==a||null==a.self)&&o("Resource does not have a self link",b,c),a}function f(a){return a?a.curies:[]}function g(a,b,c){var e=i(a,n,b,c);return null==e?e:(Object.keys(e).forEach(function(a){e[a]=e[a].map(function(e){var f=null!=b?[]:null,g=d(e,f,c.push(a));return g._original=e,g})}),e)}function h(a,b){Object.keys(a).forEach(function(c){"_links"!==c&&"_embedded"!==c&&(b[c]=a[c])})}function i(a,b,c,d){if(null==a)return a;var e={};return Object.keys(a).forEach(function(f){e[f]=j(f,a[f],b,c,d)}),e}function j(a,b,c,d,e){return l(b)?b.map(function(b){return c(a,b,d,e)}):[c(a,b,d,e)]}function k(a,b,c,d){if(!m(b))throw new Error("Link object is not an actual object: "+b+" ["+typeof b+"]");var e=q(b);return Object.keys(u).forEach(function(b){null==e[b]&&(u[b].required&&o("Link misses required property "+b+".",c,d.push(a)),null!=u[b].defaultValue&&(e[b]=u[b].defaultValue))}),e.deprecation&&p("Warning: Link "+r(d.push(a))+" is deprecated, see "+e.deprecation),e.templated!==!0&&e.templated!==!1&&(e.templated=!1),c?(e.href&&e.href.indexOf("{")>=0&&!e.templated&&o('Link seems to be an URI template but its "templated" property is not set to true.',c,d.push(a)),e):e}function l(a){return"[object Array]"===Object.prototype.toString.call(a)}function m(a){return"object"==typeof a}function n(a,b){return b}function o(a,b,c){b&&b.push({path:r(c),message:a})}function p(a){"undefined"!=typeof console&&"function"==typeof console.log&&console.log(a)}function q(a){var b={};return Object.keys(a).forEach(function(c){b[c]=a[c]}),b}function r(a){for(var b="$.",c=0;c<a.array().length;c++)b+=a.array()[c]+".";return b=b.substring(0,b.length-1)}var s=a("./resource"),t=a("./immutable_stack"),u={href:{required:!0,defaultValue:null},templated:{required:!1,defaultValue:!1},type:{required:!1,defaultValue:null},deprecation:{required:!1,defaultValue:null},name:{required:!1,defaultValue:null},profile:{required:!1,defaultValue:null},title:{required:!1,defaultValue:null},hreflang:{required:!1,defaultValue:null}};c.prototype.parse=function(a,b){var c=b?[]:null;return d(a,c,new t)},b.exports=c},{"./immutable_stack":3,"./resource":5}],5:[function(a,b){"use strict";function c(a,b,c,d){this._links=a||{},this._initCuries(b),this._embedded=c||{},this._validation=d||[]}function d(a,b){return null!=a?a[b]:null}function e(a,b,c){c=c||0;var e=d(a,b);return null!=e&&e.length>=1?e[c]:null}c.prototype._initCuries=function(a){if(this._curiesMap={},a){this._curies=a;for(var b=0;b<this._curies.length;b++){var c=this._curies[b];this._curiesMap[c.name]=c}}else this._curies=[];this._preResolveCuries()},c.prototype._preResolveCuries=function(){this._resolvedCuriesMap={};for(var a=0;a<this._curies.length;a++){var b=this._curies[a];if(b.name)for(var c in this._links)"curies"!==c&&this._preResolveCurie(b,c)}},c.prototype._preResolveCurie=function(a,b){var c=(this._links[b],b.split(/:(.+)/)),d=c[0];if(a.name===d)if(a.templated&&c.length>=1){var e=a.href.replace(/(.*){(.*)}(.*)/,"$1"+c[1]+"$3");this._resolvedCuriesMap[e]=b}else this._resolvedCuriesMap[a.href]=b},c.prototype.allLinkArrays=function(){return this._links},c.prototype.linkArray=function(a){return d(this._links,a)},c.prototype.link=function(a,b){return e(this._links,a,b)},c.prototype.hasCuries=function(){return this._curies.length>0},c.prototype.curieArray=function(){return this._curies},c.prototype.curie=function(a){return this._curiesMap[a]},c.prototype.reverseResolveCurie=function(a){return this._resolvedCuriesMap[a]},c.prototype.allEmbeddedResourceArrays=function(){return this._embedded},c.prototype.embeddedResourceArray=function(a){return d(this._embedded,a)},c.prototype.embeddedResource=function(a,b){return e(this._embedded,a,b)},c.prototype.original=function(){return this._original},c.prototype.validationIssues=function(){return this._validation},c.prototype.allLinks=c.prototype.allLinkArrays,c.prototype.allEmbeddedArrays=c.prototype.allEmbeddedResources=c.prototype.allEmbeddedResourceArrays,c.prototype.embeddedArray=c.prototype.embeddedResourceArray,c.prototype.embedded=c.prototype.embeddedResource,c.prototype.validation=c.prototype.validationIssues,b.exports=c},{}]},{},[1])(1)});